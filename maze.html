<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>公園迷宮｜四個出口都不通</title>
  <style>
    :root{--bg:#f1f5f9;--ink:#0f172a;--wall:#1f2937;--path:#e5f4ef;--exit:#86efac;--player:#0ea5e9;--hud:#ffffffcc}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background:linear-gradient(180deg,var(--bg),#fff 70%);
      color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif;
      display:grid; place-items:center;
    }
    .frame{position:relative; padding:16px}
    canvas{display:block; border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,.16);}
    .hud{
      position:absolute; left:50%; top:8px; transform:translateX(-50%);
      background:var(--hud); backdrop-filter:blur(8px);
      padding:8px 12px; border-radius:999px; display:flex; gap:12px; align-items:center;
      font-weight:600; box-shadow:0 8px 24px rgba(0,0,0,.08);
      user-select:none
    }
    .hud kbd{background:#00000010; padding:2px 6px; border-radius:6px; font-weight:700}
    .btns{position:absolute; right:8px; bottom:8px; display:flex; gap:8px}
    button{border:0; padding:10px 12px; border-radius:10px; font-weight:700; cursor:pointer; background:#111827; color:#fff; box-shadow:0 6px 14px rgba(0,0,0,.2)}
    button.secondary{background:#334155}
    .toast{position:absolute; left:50%; bottom:18px; transform:translateX(-50%);
      background:#111827; color:#fff; padding:10px 14px; border-radius:12px; font-weight:700; box-shadow:0 10px 30px rgba(0,0,0,.35); opacity:0; transition:opacity .3s}
    .toast.show{opacity:1}
    /* On-screen dpad for mobile */
    .dpad{position:absolute; left:12px; bottom:12px; display:grid; grid-template:repeat(3,46px)/repeat(3,46px); gap:8px}
    .dpad button{background:#0f172a; opacity:.9}
    .dpad .ghost{visibility:hidden}
  </style>
</head>
<body>
  <div class="frame">
    <div class="hud" aria-live="polite">
      <span>步數：<b id="moves">0</b></span>
      <span>目標：找到出口？</span>
      <span style="opacity:.7">操作：<kbd>↑↓←→</kbd>/<kbd>WASD</kbd></span>
    </div>
    <canvas id="view" width="600" height="440" aria-label="公園迷宮畫面"></canvas>
    <div class="btns">
      <button id="restart">重新開始</button>
      <button class="secondary" id="hint">提示</button>
    </div>
    <div class="toast" id="toast" role="status" aria-live="polite"></div>
    <div class="dpad" id="dpad" aria-hidden="true">
      <button data-dx="0" data-dy="-1">↑</button>
      <div class="ghost"></div>
      <button data-dx="0" data-dy="1">↓</button>
      <button data-dx="-1" data-dy="0">←</button>
      <div class="ghost"></div>
      <button data-dx="1" data-dy="0">→</button>
      <div class="ghost"></div>
    </div>
  </div>

  <script>
  // === 基本設定 ===
  const CELL=40, COLS=15, ROWS=11; // 600x440
  const canvas = document.getElementById('view');
  const ctx = canvas.getContext('2d');
  const toast = document.getElementById('toast');
  const movesEl = document.getElementById('moves');

  // 地圖圖例：0=路、1=牆、2=出口（假）、3=樹（裝飾/可互動）
  // 這是一個簡單手刻迷宮，四邊各留一個出口格子（實際不可通）
  const baseMap = [
    // 0..14 (15 cols)
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], // 0 top wall
    [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
    [1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],
    [1,0,1,0,0,0,0,0,1,0,0,0,1,0,1],
    [1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
    [1,0,0,0,0,3,0,0,0,0,0,0,1,0,1], // 中央放一棵樹(3)
    [1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
    [1,0,1,0,0,0,0,0,1,0,0,0,1,0,1],
    [1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],
    [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], // 10 bottom wall
  ];
  // 四個出口位置（視覺上通往外面，但實際被阻擋）
  const exits = [ {x:7,y:0}, {x:14,y:5}, {x:7,y:10}, {x:0,y:5} ];

  // 在 baseMap 上標記出口
  const M = baseMap.map((row,y)=> row.map((v,x)=> {
    if (exits.some(e=>e.x===x && e.y===y)) return 2; // 假出口
    return v;
  }));

  const messages = [
    '此路不通。', '前方施工中。', '鐵柵欄擋住了去路。',
    '一陣風傳來聲音：回去吧。', '雜草叢生，走不過去。', '保全：公園尚未開放出入口。'
  ];

  let player, moves;

  function reset(){
    player = {x:1, y:1};
    moves = 0; updateHUD();
    draw();
    say('在公園裡散步吧。四個出口看起來都能出去…嗎？',1200);
  }

  function updateHUD(){ movesEl.textContent = moves; }

  function say(text, ms=1500){
    toast.textContent = text;
    toast.classList.add('show');
    clearTimeout(say._t);
    say._t = setTimeout(()=> toast.classList.remove('show'), ms);
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<ROWS;y++){
      for(let x=0;x<COLS;x++){
        const t = M[y][x];
        // 背景路徑
        ctx.fillStyle = t===1 ? getComputedStyle(document.documentElement).getPropertyValue('--wall') : getComputedStyle(document.documentElement).getPropertyValue('--path');
        ctx.fillRect(x*CELL,y*CELL,CELL,CELL);
        // 出口著色
        if(t===2){
          ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--exit');
          ctx.fillRect(x*CELL,y*CELL,CELL,CELL);
        }
        // 樹木裝飾
        if(t===3){
          drawTree(x,y);
        }
        // 網格淡線
        ctx.strokeStyle = 'rgba(15,23,42,.08)';
        ctx.strokeRect(x*CELL+0.5,y*CELL+0.5,CELL-1,CELL-1);
      }
    }
    drawPlayer();
  }

  function drawTree(x,y){
    const cx = x*CELL + CELL/2, cy = y*CELL + CELL/2;
    // 樹幹
    ctx.fillStyle = '#8b5a2b';
    ctx.fillRect(cx-4, cy+6, 8, 14);
    // 樹冠
    ctx.beginPath();
    ctx.arc(cx, cy, 14, 0, Math.PI*2);
    ctx.fillStyle = '#10b981';
    ctx.fill();
  }

  function drawPlayer(){
    const cx = player.x*CELL + CELL/2;
    const cy = player.y*CELL + CELL/2;
    ctx.beginPath();
    ctx.arc(cx, cy, 12, 0, Math.PI*2);
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--player');
    ctx.fill();
    // 小陰影
    ctx.beginPath();
    ctx.ellipse(cx, cy+10, 12, 5, 0, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(0,0,0,.15)';
    ctx.fill();
  }

  function tryMove(dx,dy){
    const nx = player.x + dx;
    const ny = player.y + dy;
    // 邊界保護
    if(nx<0||ny<0||nx>=COLS||ny>=ROWS) return;
    const t = M[ny][nx];
    if(t===1){ // 牆
      bump(nx,ny); return;
    }
    if(t===2){ // 出口：顯示不通
      say(messages[(Math.random()*messages.length)|0]);
      bump(nx,ny); return;
    }
    // 允許走到樹旁邊，若站在樹上(3)也視為路可走，並給彩蛋文字
    player.x = nx; player.y = ny; moves++; updateHUD(); draw();
    if(t===3){
      say('你摸了大樹，什麼也沒有發生。也許…這裡本來就沒有出口。');
    }
  }

  function bump(nx,ny){
    // 輕微抖動效果
    const ox = canvas.style.marginLeft;
    let i=0; const id = setInterval(()=>{
      canvas.style.marginLeft = (i%2?'-':'') + '2px';
      if(++i>6){ clearInterval(id); canvas.style.marginLeft = ox; }
    }, 30);
  }

  // 鍵盤操作
  const keys = {ArrowUp:[0,-1], ArrowDown:[0,1], ArrowLeft:[-1,0], ArrowRight:[1,0],
                w:[0,-1], s:[0,1], a:[-1,0], d:[1,0], W:[0,-1], S:[0,1], A:[-1,0], D:[1,0]};
  addEventListener('keydown', e=>{
    const v = keys[e.key];
    if(v){ e.preventDefault(); tryMove(v[0],v[1]); }
  });

  // 重新開始與提示
  document.getElementById('restart').addEventListener('click', reset);
  document.getElementById('hint').addEventListener('click', ()=>{
    say('提示：四個出口都不通。真正的結局，也許是…在公園裡待一會兒。', 2200);
  });

  // 行動裝置 dpad
  document.getElementById('dpad').addEventListener('click', (e)=>{
    const b = e.target.closest('button'); if(!b) return;
    tryMove(parseInt(b.dataset.dx,10), parseInt(b.dataset.dy,10));
  });
  // 如果窄螢幕就顯示 dpad
  function updateDpad(){
    document.getElementById('dpad').style.display = matchMedia('(max-width: 760px)').matches ? 'grid' : 'none';
  }
  addEventListener('resize', updateDpad);

  // 初始
  updateDpad();
  reset();
  </script>
</body>
</html>